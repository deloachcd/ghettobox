proxy: |
  location / {
    proxy_pass: http://localhost:4533;
  }

firewall:
  - port: 4533
    scope: lan

tasks:
  - name: Ensure navidrome music library exists, and gb_user owns it
    file:
      path: "{{ navidrome_music_path }}"
      state: directory
      owner: "{{ gb_user }}"

  - name: Ensure we have a directory for Navidrome data on the host
    file:
      path: "{{ gb_root }}/data/navidrome"
      state: directory

  - name: Copy over Navidrome config
    copy:
      src: navidrome.toml
      dest: "{{ gb_root }}/data/navidrome/config.toml"

compose:
  navidrome:
    image: deluan/navidrome:latest
    user: "{{ gb_user_uid }}:{{ gb_user_gid }}"
    ports:
      - "4533:4533"
    environment:
      ND_CONFIGFILE: "/data/config.toml"
    volumes:
      - "./volumes/navidrome:/data"
      - "{{ navidrome_music_path }}:/music:ro"
    restart: always
  
